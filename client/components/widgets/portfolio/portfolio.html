<div ng-show="!error">
  <div class="widget-body-top-button">
    <a class="btn btn-block btn-primary" ng-click="create()">Add Portfolio</a>
    <button class="btn btn-secondary" ng-click="get()">
      <i class="fa fa-refresh"></i>
    </button>
  </div>

  <ul class="list" ng-repeat="portfolio in portfolios">

    <!-- <pre ng-repeat="transaction in portfolio.transactions">{{transaction || json}}</pre> -->

    <li class="list_item active">
      <div class="list_item_btn">
        <a class="btn btn-secondary" ng-click="remove(portfolio)">
          <o class="fa fa-trash-o"></o>
        </a>
      </div>

      <div class="list_item_data">
        <input type="text" class="form-control" ng-model="portfolio.name" ng-blur="update(portfolio)" placeholder="Symbol"/>
      </div>
    </li>

    <li class="list_item">
      <div class="list_item_btn">
        <a class="btn btn-link-light">
          <i class="fa fa-file-o"></i>
        </a>
      </div>

      <div class="list_item_data">
        <form ng-submit="addTransaction(portfolio, forms['form' + $index])" name="forms.form{{$index}}" novalidate>
          <div class="row">
            <div class="col-md-1">
              <input class="form-control" placeholder="Symbol" ng-model="portfolio.newTransaction.symbol" name="item" type="text" required/>
            </div>
            <div class="col-md-1">
              <input type="text" placeholder="Tx date" class="form-control" uib-datepicker-popup ng-model="portfolio.newTransaction.date" is-open="open" ng-focus="open = true" datepicker-options="dateOptions" ng-required="true" close-text="Close" />
              <!-- <input class="form-control" placeholder="Date" ng-model="portfolio.newTransaction.date" name="date" type="date" required/> -->
            </div>
            <div class="col-md-1">
              <select class="form-control" placeholder="Type" ng-model="portfolio.newTransaction.operation" name="type" ng-options="operation.id as operation.label for operation in operations" required>
                <option value="">Type</option>
              </select>
            </div>
            <div class="col-md-1">
              <input class="form-control" placeholder="Quantity" ng-model="portfolio.newTransaction.quantity" name="quantity" type="number" max="portfolio.newTransaction.quantitymax" required/>
            </div>
            <div class="col-md-1">
              <input class="form-control" placeholder="Price" ng-model="portfolio.newTransaction.price" name="price" type="number" required/>
            </div>
            <div class="col-md-1">
              <input class="form-control" placeholder="Tx cost" ng-model="portfolio.newTransaction.txcost" name="txcost" type="number" required/>
            </div>
            <div class="col-md-1">
              <input class="form-control" placeholder="Sell price" ng-model="portfolio.newTransaction.sellprice" name="sellprice" type="number" />
            </div>
            <div class="col-md-1">
              Mkt Price
            </div>
            <div class="col-md-2 text-right">
              Market Value
            </div>
            <div class="col-md-1 text-right">
              Return
            </div>
          </div>
          <input type="submit" class="hidden"/>
        </form>
      </div>
    </li>

    <li class="list_item" ng-repeat="transaction in portfolio.transactions">
      <div class="list_item_btn">
        <sub-menu-btn>
          <a class="btn btn-link-light" ng-click="updateTransaction(portfolio, transaction)">
            <i class="fa fa-pencil"></i>
          </a>
          <a class="btn btn-link-light" ng-click="splitTransaction(portfolio, transaction)">
            <i class="fa fa-chevron-right"></i>
          </a>
          <a class="btn btn-link-light" ng-click="removeTransaction(portfolio, transaction)">
            <i class="fa fa-trash"></i>
          </a>
        </sub-menu>
      </div>

      <div class="list_item_data">
        <div class="row">
          <div class="col-md-1">
            {{transaction.symbol}}
          </div>
          <div class="col-md-1">
            {{transaction.date | date}}
          </div>
          <div class="col-md-1">
            {{transaction.operation | operation:operations}}
          </div>
          <div class="col-md-1">
            {{transaction.quantity}}
          </div>
          <div class="col-md-1">
            {{transaction.price | currency}}
          </div>
          <div class="col-md-1">
            {{transaction.txcost | currency}}
          </div>
          <div class="col-md-1">
            {{transaction.sellprice | currency}}
          </div>
          <div class="col-md-1">
            {{transaction.value | currency}}
          </div>
          <div class="col-md-2 text-right" ng-init="transaction.total = (transaction.price * transaction.quantity)">
            {{transaction.total | currency}}
          </div>
          <div class="col-md-1 text-right" ng-init="transaction.delta = (transaction.value - transaction.price) * transaction.quantity">
            <span val="transaction.delta" filter="currency"></span>
          </div>
        </div>
      </div>
    </li>

    <li class="list_item extra">
      <dl class="dl-horizontal">
        <dt>Total</dt>
        <span val="getTotal(portfolio)" filter="currency"></span>
      </dl>
    </li>

  </ul>
</div>

<error error="" class="error" ng-show="error">
  <p>{{error.message}}</p>
</error>
